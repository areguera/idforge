######################################################################
#
#   Validate images rendition environments.
#
#   Expected directory structure:
#   ------------------------------------------------------------------
#   Library/QaTests/qatest-2015012847797252944
#   |-- Final
#   |   |-- 443x443.png
#   |   |-- 765x990.png
#   |   |-- en_US
#   |   |   |-- document.jpg
#   |   |   |-- document-media-0.1.2-i686-CD1of4.png
#   |   |   |-- document-media-0.1.2-i686-CD2of4.png
#   |   |   |-- document-media-0.1.2-i686-CD3of4.png
#   |   |   |-- document-media-0.1.2-i686-CD4of4.png
#   |   |   |-- document-media-0.1.2-i686-DVD1of2.png
#   |   |   |-- document-media-0.1.2-i686-DVD2of2.png
#   |   |   |-- document-media-0.1.2-x86_64-CD1of4.png
#   |   |   |-- document-media-0.1.2-x86_64-CD2of4.png
#   |   |   |-- document-media-0.1.2-x86_64-CD3of4.png
#   |   |   |-- document-media-0.1.2-x86_64-CD4of4.png
#   |   |   |-- document-media-0.1.2-x86_64-DVD1of2.png
#   |   |   |-- document-media-0.1.2-x86_64-DVD2of2.png
#   |   |   |-- document-media-0.1-i686-CD1of4.png
#   |   |   |-- document-media-0.1-i686-CD2of4.png
#   |   |   |-- document-media-0.1-i686-CD3of4.png
#   |   |   |-- document-media-0.1-i686-CD4of4.png
#   |   |   |-- document-media-0.1-i686-DVD1of2.png
#   |   |   |-- document-media-0.1-i686-DVD2of2.png
#   |   |   |-- document-media-0.1-x86_64-CD1of4.png
#   |   |   |-- document-media-0.1-x86_64-CD2of4.png
#   |   |   |-- document-media-0.1-x86_64-CD3of4.png
#   |   |   |-- document-media-0.1-x86_64-CD4of4.png
#   |   |   |-- document-media-0.1-x86_64-DVD1of2.png
#   |   |   |-- document-media-0.1-x86_64-DVD2of2.png
#   |   |   |-- document.png
#   |   |   |-- document.tif
#   |   |   `-- ffffff-0
#   |   |       `-- 24221c-1
#   |   |           `-- 990
#   |   |               `-- document-copyright.png
#   |   |-- es_ES
#   |   |   |-- document.jpg
#   |   |   |-- document-media-0.1.2-i686-CD1of4.png
#   |   |   |-- document-media-0.1.2-i686-CD2of4.png
#   |   |   |-- document-media-0.1.2-i686-CD3of4.png
#   |   |   |-- document-media-0.1.2-i686-CD4of4.png
#   |   |   |-- document-media-0.1.2-i686-DVD1of2.png
#   |   |   |-- document-media-0.1.2-i686-DVD2of2.png
#   |   |   |-- document-media-0.1.2-x86_64-CD1of4.png
#   |   |   |-- document-media-0.1.2-x86_64-CD2of4.png
#   |   |   |-- document-media-0.1.2-x86_64-CD3of4.png
#   |   |   |-- document-media-0.1.2-x86_64-CD4of4.png
#   |   |   |-- document-media-0.1.2-x86_64-DVD1of2.png
#   |   |   |-- document-media-0.1.2-x86_64-DVD2of2.png
#   |   |   |-- document-media-0.1-i686-CD1of4.png
#   |   |   |-- document-media-0.1-i686-CD2of4.png
#   |   |   |-- document-media-0.1-i686-CD3of4.png
#   |   |   |-- document-media-0.1-i686-CD4of4.png
#   |   |   |-- document-media-0.1-i686-DVD1of2.png
#   |   |   |-- document-media-0.1-i686-DVD2of2.png
#   |   |   |-- document-media-0.1-x86_64-CD1of4.png
#   |   |   |-- document-media-0.1-x86_64-CD2of4.png
#   |   |   |-- document-media-0.1-x86_64-CD3of4.png
#   |   |   |-- document-media-0.1-x86_64-CD4of4.png
#   |   |   |-- document-media-0.1-x86_64-DVD1of2.png
#   |   |   |-- document-media-0.1-x86_64-DVD2of2.png
#   |   |   |-- document.png
#   |   |   |-- document.tif
#   |   |   `-- ffffff-0
#   |   |       `-- 24221c-1
#   |   |           `-- 990
#   |   |               `-- document-copyright.png
#   |   `-- ffffff-0
#   |       |-- 24221c-1
#   |       |   |-- 192
#   |       |   |   `-- idforge-logo-message.png
#   |       |   `-- 48
#   |       |       `-- idforge-symbol.png
#   |       |-- 2c5aa0-1
#   |       |   `-- 48
#   |       |       `-- idforge-symbol.png
#   |       |-- 88aa00-1
#   |       |   `-- 48
#   |       |       `-- idforge-symbol.png
#   |       |-- a02c2c-1
#   |       |   `-- 48
#   |       |       `-- idforge-symbol.png
#   |       |-- d45500-1
#   |       |   `-- 48
#   |       |       `-- idforge-symbol.png
#   |       |-- d4aa00-1
#   |       |   `-- 48
#   |       |       `-- idforge-symbol.png
#   |       |-- e3e2db-1
#   |       |   `-- 940
#   |       |       `-- 715x940.png
#   |       |-- ffffff-0.3
#   |       |   `-- 724
#   |       |       `-- idforge-symbol-bg.png
#   |       `-- ffffff-1
#   |           `-- 48
#   |               `-- idforge-logo.png
#   |-- qatest-2015012847797252944.conf
#   `-- qatest-2015012847797252944.mime
#   
#   29 directories, 70 files
#   ------------------------------------------------------------------
#
#   The CentOS Artwork SIG <centos-devel@centos.org>
#
######################################################################

#=====================================================================
# Build Branding Images
#=====================================================================
[idforge-logo.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/idforge-logo.svg"
# NOTE: When the configuration file is in a location that cannot be
# considered relative to the source files being process by it, the
# source files must be specified using absolute paths, not relative
# paths. Otherwise, the rendition process won't find the source files
# (because a wrong path construction) and the script finishes with an
# error message.
render-logic        = "remove-first"
svg-flow            = "extended"
svg-flow-options    = "48:ffffff-1:ffffff-0"

[idforge-logo-message.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/idforge-logo-message.svg"
svg-flow            = "extended"
svg-flow-options    = "192:24221c-1:ffffff-0"

[idforge-symbol.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/idforge-symbol.svg"
svg-flow            = "extended"
svg-flow-options    = "48:24221c-1 d4aa00-1 88aa00-1 d45500-1 a02c2c-1 2c5aa0-1:ffffff-0"

[idforge-symbol-bg.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/idforge-symbol.svg"
svg-flow            = "extended"
svg-flow-options    = "724:ffffff-0.3:ffffff-0"

#=====================================================================
# Build Background For All Documents
#=====================================================================
# The following three sections build the image that will be used as
# document background in all cases.  This background image
# (765x990.png) is composed of two images (715x940.png and
# document-copyright.png) that are put one above the other to create
# the final composition. The image document-copyright.png is subject
# to localization but the rest is not.
[715x940.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/document-background-inner.svg"
svg-flow            = "extended"
svg-flow-options    = "940:e3e2db-1:ffffff-0"
svg-enable-siblings = "png"
png-flow            = "base"
png-base-composition = "ffffff-0/ffffff-0.3/724/idforge-symbol-bg.png:x724+275+166"

[document-copyright.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/document-copyright.svg"
render-from-po      = "${PWD}/Library/QaTests/qatest-commons/Models/Images/Locales/${IDFORGE_LANG_LC}/document-copyright.po"
svg-flow            = "extended"
svg-flow-options    = "990:24221c-1:ffffff-0"
xml-expand          = "=PRODUCT_NAME=idFORGE"
xml-expand          = "=COPYRIGHT_YEAR=$(date +%Y)"
xml-expand          = "=COPYRIGHT_HOLDER=The CentOS Artwork SIG"
xml-expand          = "=IDFORGE_VERSION=${IDFORGE_VERSION}"
xml-expand          = "=LICENSE=Free Art 1.3 License"

[765x990.png]
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/document-background.svg"
svg-flow            = "base"
svg-enable-siblings = "png"
png-flow            = "base"
png-base-composition = "ffffff-0/e3e2db-1/940/715x940.png:x940+25+25"
# NOTE: Since files are produced relative to configuration files there
# is no need to specify them using absolute paths. Relative paths are
# fine.  They are shorter.
png-base-composition = "${IDFORGE_LANG_LC}/ffffff-0/24221c-1/990/document-copyright.png:x990+0+0"
# NOTE: Whenever you use relative paths to call files which are
# subject to localization (either the specified PO file exists or
# not), you must include the locale information on the path
# dynamically (e.g., using the IDFORGE_LANG_LC environment variable).
# Otherwise the file won't be found and the script ends with an error
# message.

#=====================================================================
# Build Backgrounds For Installation Media
#=====================================================================
# The following two sections describe how to brand an image that has
# been previously cropped from a higher one. This is a fundamental
# construction in order to build branded background images for
# different visual manifestations based on the same artistic motif.
# This is also an example of how you can use the png module to perform
# operations directly on png images.
[443x443.png]
# Crop the image from a higher one. The final image is stored at
# render-directory and using the section name as file name.
render-from          = "${PWD}/Library/QaTests/qatest-commons/Backgrounds/640x480.png"
png-flow             = "base"
png-base-command     = "convert -extract 443x443+0+0 +repage ${RENDER_FROM_FILE} ${RENDER_FILE}"

[443x443-symlink.png]
# Test creation of symbolic links from a PNG file already created.
# This is sometimes convenient to make references to default
# background images without changing the background image file names
# but a specific file name is required to specify the default
# background image.
render-from          = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/443x443.png"
png-flow             = "base"
png-base-command     = "ln -s ${RENDER_FROM_FILE} ${RENDER_FILE}"

[443x443-branded.png]
# Brand the cropped image. The name of the section is not irrelevant
# in cases like this because the changes are applied directly in the
# image provided as value to render-from option.
render-from          = "443x443.png"
png-flow             = "base"
png-base-composition = "ffffff-0/ffffff-1/48/idforge-logo.png:x48+96+80"

#=====================================================================
# Build Final Images
#=====================================================================

[document-media.png] # For installation media
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/document-cd-label.svg"
render-from-po      = "${PWD}/Library/QaTests/qatest-commons/Models/Images/Locales/${IDFORGE_LANG_LC}/document-cd-label.po"
xml-expand-background = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/765x990.png"
# NOTE: Whenever you are expanding file paths through xml-expand or
# xml-expand-background in a configuration section where
# render-from-po is present, it is necessary to use absolute paths for
# those files.  This is necessary to prevent the locale path
# corrections applied to render-directory from affecting the path you
# specify.
xml-expand          = "=PRODUCT_NAME=idFORGE"
xml-expand          = "=BACKGROUND_IMAGE_CD=${PWD}/Library/QaTests/qatest-2015012847797252944/Final/443x443.png"
svg-flow            = "media"
svg-flow-options    = "0.1 0.1.2:i686 x86_64:DVD*2 CD*4"

[document.png]      # For regular image composition.
render-from         = "${PWD}/Library/QaTests/qatest-commons/Models/Images/document-text.svg"
render-from-po      = "${PWD}/Library/QaTests/qatest-commons/Models/Images/Locales/${IDFORGE_LANG_LC}/document-text.po"
xml-expand-background = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/765x990.png"
xml-expand          = "=CONFIG_SECTIONS=$(echo ${CONFIG_SECTIONS} | sed -r 's/[[:space:]]+/, /g')"
svg-enable-siblings = "png"
png-flow            = "base"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/24221c-1/192/idforge-logo-message.png:x192+181+90"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/24221c-1/48/idforge-symbol.png:x16+126.009+801.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/24221c-1/48/idforge-symbol.png:x24+151.041+793.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/24221c-1/48/idforge-symbol.png:x32+184.070+785.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/24221c-1/48/idforge-symbol.png:x48+225.095+769.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d4aa00-1/48/idforge-symbol.png:x16+327.209+801.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d4aa00-1/48/idforge-symbol.png:x24+352.241+793.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d4aa00-1/48/idforge-symbol.png:x32+385.270+785.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d4aa00-1/48/idforge-symbol.png:x48+426.295+769.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/88aa00-1/48/idforge-symbol.png:x16+528.409+801.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/88aa00-1/48/idforge-symbol.png:x24+553.441+793.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/88aa00-1/48/idforge-symbol.png:x32+586.469+785.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/88aa00-1/48/idforge-symbol.png:x48+627.494+769.666"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/2c5aa0-1/48/idforge-symbol.png:x16+126.009+887.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/2c5aa0-1/48/idforge-symbol.png:x24+151.041+879.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/2c5aa0-1/48/idforge-symbol.png:x32+184.070+871.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/2c5aa0-1/48/idforge-symbol.png:x48+225.095+855.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/a02c2c-1/48/idforge-symbol.png:x16+327.209+887.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/a02c2c-1/48/idforge-symbol.png:x24+352.241+879.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/a02c2c-1/48/idforge-symbol.png:x32+385.270+871.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/a02c2c-1/48/idforge-symbol.png:x48+426.295+855.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d45500-1/48/idforge-symbol.png:x16+528.409+887.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d45500-1/48/idforge-symbol.png:x24+553.441+879.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d45500-1/48/idforge-symbol.png:x32+586.469+871.465"
png-base-composition = "${PWD}/Library/QaTests/qatest-2015012847797252944/Final/ffffff-0/d45500-1/48/idforge-symbol.png:x48+627.494+855.465"
png-base-exports = "jpg tif"
